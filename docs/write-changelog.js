const fs = require('fs');
const path = require('path');
const showdown = require('showdown');

// Read the contents of README.md
fs.readFile('CHANGELOG.md', 'utf8', (err, data) => {
  if (err) {
    console.error('Error reading CHANGELOG.md:', err);
    return;
  }

  // Remove unwanted phrases from the markdown data
  const modifiedData = data
    .replace(
      /Generated by \[`auto-changelog`\]\(https:\/\/github\.com\/CookPete\/auto-changelog\)\./g,
      ''
    )
    .replace(/Changelog/g, '')
    .replace(
      /All notable changes to this project will be documented in this file. Dates are displayed in UTC./g,
      ''
    );

  // Convert markdown to HTML
  const converter = new showdown.Converter();
  const html = converter.makeHtml(modifiedData);

  // Construct the HTML content with the README data
  const htmlContent = `
    <!DOCTYPE html>
    <html lang="en">
      <head>
        <title>CHANGELOG</title>
        <link rel="stylesheet" href="docs.css">
      </head>
      <body>
        <div class="container">
          <div class="wrapper">
            <div class="header">
            <a class="hover-underline-only" href="index.html">Home</a>
            
            </div>
            <div class="grid">
              <div class="changelog-container">
                <h1 class="doc-header-text">Changelog</h1>
                <p class="sub-text">All notable changes to this project will be documented in this file. Dates are displayed in UTC.</p>
                <div class="changelog-card">
                  ${html}
                </div>
              </div>
            </div>
          </div>
        </div>
      </body>
    </html>
  `;

  // Write the HTML content to changelog.html
  fs.writeFile('./docs/changelog.html', htmlContent, (err) => {
    if (err) {
      console.error('Error writing changelog.html:', err);
      return;
    }
    console.log('changelog.html created successfully!');
  });
});
